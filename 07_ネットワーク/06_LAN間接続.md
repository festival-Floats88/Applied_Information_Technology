# **6. LAN間接続**

## **1. LAN間接続機器とプロトコル階層**

各種LAN間接続機器とサポートするプロトコル階層の対応は次のようになる.

- ゲートウェイ

    物理層, データリンク層, ネットワーク層, トランスポート層～アプリケーション層

- ルータ, レイヤ3スイッチ

    物理層, データリンク層, ネットワーク層

- ブリッジ, スイッチングハブ(レイヤ2スイッチ)

    物理層, データリンク層

- リピータ, リピーティングハブ

    物理層

### **リピータ**, **リピーティングハブ**

**リピータ**は, LAN同士を`物理層で接続する`装置で, 複数ポートを持つリピータを特に**リピーティングハブ**と呼ぶ.

リピータは電気信号の整形・増幅を行う機能を持ち, LANを延長する際に用いられる.

### **ブリッジ**, **レイヤ2スイッチ**

**ブリッジ**は, LAN同士を`データリンク層で接続する`装置で, 複数ポートを持つ機器を特に**スイッチングハブ**(**レイヤ2スイッチ**)と呼ぶ.

ブリッジは, データリンク層のアドレスであるMACアドレスに従って, フレームを中継する. ブリッジを用いると, 必要なポートにのみフレームを流すため, 不要なトラフィックを発生させない.

### **ルータ**, **レイヤ3スイッチ**

**ルータ**は, LAN同士を`ネットワーク層で接続する`装置で, 複数のポートを持つ機器をレイヤ3スイッチと呼ぶ.

ネットワーク層のアドレスであるIPアドレスに従い, 最適な経路でパケットを中継することができる. ルータは, ネットワーク層までのプロトコル変換機能をもつため, 伝送媒体やアクセス制御方式の異なるLAN同士を接続することができる.

### **ゲートウェイ**

**ゲートウェイ**は, LAN同士を`アプリケーション層で接続する`装置である.

ゲートウェイは, アプリケーション層を含む全階層のプロトコルを解析・変換できるため, プロトコルが完全に異なるLANであっても接続することができる.

## **2. スパニングツリー**

ブリッジやスイッチングハブは, 受信したブロードキャストフレームを全てのポートに送出するため, 通信経路上にループがあると, ループ中をブロードキャストフレームが循環し続けることになる. これを**ブロードキャストストーム**という.

これを防ぐには, ポートの一部をブロックしてループを切断する必要がある. これを行うプロトコルを**スパニングツリー**という.

### **STP**(スパニングツリープロトコル)

**STP**はIEEE802.1Dとして標準化されている. STPでは, 各ブリッジが**BPDU**を交換し, 以下の制御を行う.

> **BPDU**(Bridge Protocol Data Unit): 制御情報

- 最も優先度の高いブリッジを木構造の根となる**ルートブリッジ**とする
- 各ブリッジのうち, 最もルートブリッジに近いポートを**ルートポート**とする

    > 距離が同じなら優先度の高いブリッジに接続されたポート
- 各ブリッジのうち, 葉側のブリッジに向かうポートを**指定ポート**とする

    > 各リンクのルートブリッジに近いポートに等しい
- それ以外のポートを**ブロックポート**とする

ブロックポートは制御情報の受信のみを行い, データフレームを送出しない予備ポートとなるため, LANのループを解消できる.

STPでは各ポートが制御情報を定期的に交換する. 制御情報が届かなくなったり, 今までと異なる制御情報が届いたりすると, トポロジが変更されたと判断し, 木構造の再構築を行う. 各ポートはデータフレームを中継せずに交換するため, トポロジの変更には数十秒程度の時間が必要となる.

## **3. ネットワークの仮想化**

データ通信を最適化するためには, 業務や通信量の変化に合わせてネットワーク構成を見直さなければならないが, ネットワークを物理的に繋ぎ替えるのは大変な作業となるため, ネットワークそのものを仮想化し, `物理的な構成に影響されることなくネットワークを構築する`技術が進んでいる.

### **VLAN**(Virtual LAN)

**VLAN**とは, スイッチングハブのポートや接続される端末などをグループ化することで, `物理的な接続形態に依存しない論理的なネットワーク(仮想的なネットワーク)を構築`する技術である.

VLANを用いるとブロードキャストドメインも分割されるため, 通信量の削減を図ることができる.

### **SDN**

VLANには, 大規模なネットワークを仮想化しにくいという欠点がある. そこで, 更に仮想化を進め「`ネットワーク構成をソフトウェアで定める`」という考えが生まれた. これに基づくネットワークを, **SDN**(Software-Defined Networking)という.

**OpenFlow**は, SDNを実現する技術の1つで, ネットワーク制御機能を持つ**OpenFlowコントローラ**とデータ転送機能を持つ**OpenFlowスイッチ**から構成される. スイッチにはパケットを受け取った際の処理方法が登録されている.

パケットを受け取ったスイッチは, まず自身の**フローテーブル**から処理方法を検索する. 該当するエントリがフローテーブルになければ, コントローラに問い合わせる. スイッチはコントローラから返された処理方法に基づいてフローテーブルを更新し, パケットを処理する.

## **4. VRRP**(Virtual Router Redundancy Protocol)

**VRRP**は`ルータを冗長化してネットワークの信頼性を高める`プロトコルである. 複数のルータをグループにまとめ, その中の1つをマスタルータとし, 他をバックアップルータとする. マスタルータの障害時には, 自動的にバックアップルータに切り替わる.
