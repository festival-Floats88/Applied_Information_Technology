# **1. プロトコルの全体像**

## **1. 通信規格とプロトコル**

通信には規格が必要である. 規格には「通信を行う上での様々な約束事」が含まれる. それら個々の約束事や約束事の集まりを**プロトコル**(通信規格)という.

## **2. プロトコルと階層**

プロトコルは, その役割に応じていくつかのレベルに分けられる.

まず, LAN上でデータを伝送するために, `LANレベルのプロトコル`が必要である. LANレベルのプロトコルは「同一LAN内」に限られるため, LANをまたぐ機能はない. LANをまたいで宛先に届けるためには, `LANを中継するプロトコル`が必要になる.

宛先のマシンに届いたデータが, 電子メールプロセスや, Webプロセスなどの, アプリケーションプロセスを識別し, `正しいプロセスに配送するためのプロトコル`が必要である. 更に, 電子メールやWebプロセスのデータ形式や伝送手順といった, `個々のアプリケーションプロセスに関するプロトコル`も必要である.

> 通信ネットワークの分野では「プロセス=プログラム」

インターネットではプロトコル群は4つのレベルに分けられる. 各レベルのことを**層**(レイヤ), 複数レイヤからなるプロトコル構造を**プロトコル階層**(プロトコルスタック)と呼ぶ.

## **3. TCP/IPの階層**

**TCP/IP**はインターネットで利用されているプロトコル群の総称で, 世界で最も普及している. TCP/IPは前述の4階層から構成される.

- **アプリケーション層**

    具体的なプロトコル: SMTP, POP, HTTP, SNMP, ...

    アプリケーション毎の動作や約束事を定める

- **トランスポート層**

    具体的なプロトコル: **`TCP`**, **`UDP`**

    アプリケーションプロセスを識別し, 正しいプロセスにデータを配送する

- **ネットワーク層(インターネット層)**

    具体的なプロトコル: **`IP`**, ICMP, ARP

    別のLANにパケットを中継する

- **データリンク層(ネットワークインターフェース層)**

    具体的なプロトコル: CSMA/CD, ATM, FDDI, ...

    単一のLAN内で実際にフレームを伝送する

> **パケット, フレーム**: データの伝送単位の呼称. 特にデータリンク層の伝送単位をフレームという

## **4. TCP/IPの階層とヘッダ**

階層化されたプロトコルでは, データは各層の適切なプロトコルを用いて処理される. 例えば, 優先LANで電子メールを送信するのであれば, 以下が選ばれる.

- **アプリケーション層**: SMTP
- **トランスポート層**: TCP
- **ネットワーク層**: IP
- **データリンク層**: CSMA/CD など

ある層で処理されたデータには, その層の機能を利用するための**ヘッダ**が付与され, 下位層に引き継がれる. ヘッダには様々な情報が設定されるが, 中でも最も大切なものがアドレスなどの識別子である. アプリケーションが作成したデータは, 最終的にはデータリンク層のフレームの形式で, LANに送出される.

フレームを受信した側は, 送信側とは逆に階層を上りながらヘッダを取り外し, もとのデータを復元する.

> **ヘッダ**: 伝送用の制御情報を格納する領域

各階層とヘッダの関係は, 以下のようになる.

- **アプリケーション層**

    アプリケーションが作成したデータのみ

- **トランスポート層**

    アプリケーション層からのデータ + 送信元プロセス, 宛先プロセスのポート番号

    > **ポート番号**: ホスト上の`アプリケーション"プロセス"を識別`する番号
    >> **ホスト**: サーバ, クライアント, ルータなどデータの送受・中継を行う機器

- **ネットワーク層(インターネット層)**

    トランスポート層からのデータ + 送信元マシン, 宛先マシンのIPアドレス

    > **IPアドレス**: インターネット上の`ホストを一意に識別`するアドレス

- **データリンク層(ネットワークインターフェース層)**

    ネットワーク層からのデータ + 送信元マシン, 中継先のマシンのMACアドレス

    > **MACアドレス**: LANに接続された`機器(LANボード)を物理的に識別`するアドレス

## **5. データ伝送とアドレスの変化**

トランスポート層のヘッダには, プロセスを識別する**ポート番号**が設定される. 送信元はブラウザ, 宛先はサーバのWebプロセスとする.

ネットワーク層は, 宛先ホストを識別してパケットを中継しなければならない. そこで, ホストを一意に識別する**IPアドレス**が設定される. 送信元はパソコン, 宛先はWebサーバである.

データリンク層は, LAN内での伝送を行う. そこで, LANの規格に沿った物理的なアドレスである**MACアドレス**が設定される. LAN内の伝送は「パソコンと中継ノード間」と「中継ノードとWebサーバ間」の2回に分けて行われる. 伝送の都度, LAN内のMACアドレスが指定し直される.

> **ノード**: ネットワークに接続される機器全般を指す呼称.
>> **エンドノード**: 通信の末端に位置する, 実際の送信元及び宛先となるノード
>>
>> **中継ノード**:データを中継するノード

`IPアドレスはエンドノードを指定し, MACアドレスは中継ノードを指定する`.

## **6. TCP/IPとOSI基本参照モデル**

TCP/IPが事実上の標準となる前に, **ISO**が**OSI基本参照モデル**と呼ばれる7階層のモデルを提案した. TCP/IPに対応するOSI基本参照モデルの層は以下のようになる.

### **TCP/IPのアプリケーション層**

- アプリケーション層

    各アプリケーションの動作

- プレゼンテーション層

    `共通の表現形式`(転送構文)に変換する機能. 文字コード変換, 表示形式の変換, 圧縮と伸長

- セッション層

    アプリケーション同士が`会話をする`ための機能. 送信権制御や動機制御など

### **TCP/IPのトランスポート層**

- トランスポート層
    セッション層が要求する品質を提供する機能. 誤り制御, 多重化など

### **TCP/IPのネットワーク層**

- ネットワーク層

    データを中継する機能

### **TCP/IPのデータリンク層**

- データリンク層

    隣接ノード間で, データを誤りなく伝送する機能

- 物理層

    ネットワークの物理的, 電気的な条件
